language: minimal

sudo: required

services:
  - docker

dist: bionic

git:
  depth: 1

notifications:
  email: false

env:
  matrix:
    - PYTHON_VER=python=3.7 CYTHON_VER=cython NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.21
    - PYTHON_VER=python=3.7 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.20
#    - PYTHON_VER=python=3.7 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.14.5 SCIPY_VER=scipy==1.1.0 SCIKIT_LEARN_VER=scikit-learn==0.19
#    - PYTHON_VER=python=3.7 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.18
#    - PYTHON_VER=python=3.7 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.17
#    - PYTHON_VER=python=3.7 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.8.1 SCIPY_VER=scipy==0.14.0 SCIKIT_LEARN_VER=scikit-learn==0.16
    - PYTHON_VER=python=3.6 CYTHON_VER=cython NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.21
    - PYTHON_VER=python=3.6 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.20
    - PYTHON_VER=python=3.6 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.14.5 SCIPY_VER=scipy==1.1.0 SCIKIT_LEARN_VER=scikit-learn==0.19
    - PYTHON_VER=python=3.6 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.18
    - PYTHON_VER=python=3.6 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.17
    - PYTHON_VER=python=3.6 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.8.1 SCIPY_VER=scipy==0.14.0 SCIKIT_LEARN_VER=scikit-learn==0.16
    - PYTHON_VER=python=3.5 CYTHON_VER=cython NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.21
    - PYTHON_VER=python=3.5 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy SCIPY_VER=scipy SCIKIT_LEARN_VER=scikit-learn==0.20
    - PYTHON_VER=python=3.5 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.14.5 SCIPY_VER=scipy==1.1.0 SCIKIT_LEARN_VER=scikit-learn==0.19
    - PYTHON_VER=python=3.5 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.18
    - PYTHON_VER=python=3.5 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.9.3 SCIPY_VER=scipy==0.16.0 SCIKIT_LEARN_VER=scikit-learn==0.17
    - PYTHON_VER=python=3.5 CYTHON_VER=cython==0.27.3 NUMPY_VER=numpy==1.8.1 SCIPY_VER=scipy==0.14.0 SCIKIT_LEARN_VER=scikit-learn==0.16

before_install:
  docker build
    -t sklearn-porter
    --build-arg PYTHON_VER=${PYTHON_VER}
    --build-arg CYTHON_VER=${CYTHON_VER}
    --build-arg NUMPY_VER=${NUMPY_VER}
    --build-arg SCIPY_VER=${SCIPY_VER}
    --build-arg SCIKIT_LEARN_VER=${SCIKIT_LEARN_VER}
    --no-cache .

before_script:
  - docker run -d -t --name test sklearn-porter
  - docker exec -it test gcc --version
  - docker exec -it test java -version
  - docker exec -it test node --version
  - docker exec -it test go version
  - docker exec -it test php --version
  - docker exec -it test ruby --version
  - docker exec -it test python --version
  - docker exec -it test conda run -n sklearn-porter python --version

script:
  docker exec -it test
    conda run -n sklearn-porter
      pytest tests -v -x -p no:doctest
        --disable-warnings --numprocesses=auto
        -o python_files="EstimatorTest.py"
        -o python_functions="test_*"

after_script: docker rm -f $(docker ps --filter name=test -q)
